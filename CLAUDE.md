# CLAUDE.md

<language>Japanese</language>

このファイルがある場所がこのプロジェクトの**ルートディレクトリ**である。

## プロジェクト概要

plurality-mcpは、Pluralityに関する議論に役に立つMCPサーバーである。

Pluralityとは、「社会的差異を超えたコラボレーションのためのテクノロジー」と定義される。

## アーキテクチャ

このプロジェクトは**pnpm**ワークスペースモノレポで、**turborepo**を使って管理されている。

### 日本語Scrapbox (`apps/scrapbox-japanese`)
[『⿻數位 Plurality』の和訳をダシにして日本語でワイワイするScrapbox](https://scrapbox.io/plurality-japanese/)の情報を抽出するMCPサーバー。
詳細は [`apps/scrapbox-japanese/CLAUDE.md`](./apps/scrapbpx-japanese/CLAUDE.md) を参照すること。

### 共通パッケージ（`packages/*`）
複数のappで利用する可能性があるものは、packages/[package name]に独立して用意する。

## ディレクトリ構成

常に変わり続けるため、各セッションのはじめや、理解に自信がない時は必ず以下のコマンドを実行して全体を把握すること：`git ls-files`

## すべてのpackage.jsonを把握する

- 設定されているpnpmスクリプトを実行したい
- 現在インストールされているパッケージを知りたい

などの状況は頻繁に訪れる。その度に、ルートディレクトリから`./scripts/list-package-json.sh`を実行すること。

このスクリプトは、このプロジェクトに存在するすべてのpackage.jsonの情報を展開する。

## 書き込み後の自動品質担保

あなたがファイルを編集したら、Hooks機能を使って以下のコマンドが自動で実行される。
- `pnpm run fix`
- `pnpm run typecheck`

これにより、Lint, Format, 型チェックが実行される。もしこれでエラーが起きるのなら、止む終えない場合を除き、適宜修正することが望ましい。
したがって原則として、**エラーを残したまま次のTODOに進むことは禁止する**

## 最新の情報を参照しなければいけない

特定のライブラリやクラウドサービスを扱うケースでは`context7`MCPを利用して最新のドキュメントを参照し、それに基づき実装すること。
特に、初めてそれをプロジェクトで使うときや、エラーや警告の対応をする場合は、必ずcontext7を活用すること。

仮にcontext7で検索しても目的の情報が得られなかった場合は、Web検索すること。

## 同じworktreeでの他のセッションによるエラーは無視する

同じworktree/branchで複数のClaude Codeセッションが稼働している場合もある。

その場合、品質担保コマンド（`fix`、`typecheck`、`build`など）の実行時に自分の作業と無関係なエラーが発生することがある。

**対応方針**：
- 自分の作業範囲と明らかに無関係なエラー（他のアプリケーションやファイルのエラー）は無視して作業を継続
- ただし、そのようなエラーが発生したことは必ずユーザーに報告する
- 例：「frontendのlintエラーが検出されましたが、私のDBパッケージの作業とは無関係なため無視しました」

この理解により、複数のClaude Codeセッションが協調して効率的に作業を進めることがでる。